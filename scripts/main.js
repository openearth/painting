function val2rgbaString(t){"use strict";var e=t.rgba,n=[e.r,e.g,e.b,e.a];return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"}function urlParams(){"use strict";for(var t,e=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(t){return decodeURIComponent(t.replace(e," "))},r=window.location.search.substring(1),a={};null!==(t=n.exec(r));){var o=i(t[2]),s=null;s="true"===o||"false"!==o&&o,a[i(t[1])]=s}return a}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(t,e){"object"==typeof exports?module.exports=e(t,t.document):"function"==typeof define&&define.amd?define(function(){return e(t,t.document)}):t.Sketch=e(t,t.document)}(this,function(t,e){"use strict";function n(t){return"function"==typeof t}function i(t){return"string"==typeof t}function r(t,e,n){for(var i in e)!n&&i in t||(t[i]=e[i]);return t}for(var a,o,s="E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min".split(" "),c=Math,l="canvas",u="dom",d=e,h=t,p=[],m={fullscreen:!0,autostart:!0,autoclear:!0,autopause:!0,container:d.body,interval:1,globals:!0,retina:!1,type:l},f={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},g={CANVAS:l,WEB_GL:"webgl",WEBGL:"webgl",DOM:u,instances:p,install:function(t){if(!t.__hasSketch){for(var e=0;e<s.length;e++)t[s[e]]=c[s[e]];r(t,{TWO_PI:2*c.PI,HALF_PI:c.PI/2,QUATER_PI:c.PI/4,random:function(t,e){return function(t){return"[object Array]"==Object.prototype.toString.call(t)}(t)?t[~~(c.random()*t.length)]:(function(t){return"number"==typeof t}(e)||(e=t||1,t=0),t+c.random()*(e-t))},lerp:function(t,e,n){return t+n*(e-t)},map:function(t,e,n,i,r){return(t-e)/(n-e)*(r-i)+i}}),t.__hasSketch=!0}},create:function(t){return(t=r(t||{},m)).globals&&g.install(self),a=t.element=t.element||d.createElement(t.type===u?"div":"canvas"),o=t.context=t.context||function(){switch(t.type){case l:return a.getContext("2d",t);case"webgl":return a.getContext("webgl",t)||a.getContext("experimental-webgl",t);case u:return a.canvas=a}}(),t.exists||(t.container||d.body).appendChild(a),g.augment(o,t)},augment:function(t,e){return e=r(e||{},m),e.element=t.canvas||t,e.element.className+=" sketch",r(t,e,!0),function(t){function e(e){n(e)&&e.apply(t,[].splice.call(arguments,1))}function a(t){for(T=0;T<z.length;T++)i(S=z[T])?w[(t?"add":"remove")+"EventListener"].call(w,S,x,!1):n(S)?x=S:w=S}function o(){C(y),y=k(o),N||(e(t.setup),N=n(t.setup)),R||(e(t.resize),R=n(t.resize)),t.running&&!D&&(t.dt=(P=+new Date)-t.now,t.millis+=t.dt,t.now=P,e(t.update),q&&(t.retina&&(t.save(),t.scale(B,B)),t.autoclear&&t.clear()),e(t.draw),q&&t.retina&&t.restore()),D=++D%t.interval}function s(){w=G?t.style:t.canvas,$=G?"px":"",j=t.width||t.element.width,E=t.height||t.element.height,t.fullscreen&&(E=t.height=h.innerHeight,j=t.width=h.innerWidth),t.retina&&q&&B&&(w.style.height=E+"px",w.style.width=j+"px",j*=B,E*=B),w.height!==E&&(w.height=E+$),w.width!==j&&(w.width=j+$),N&&e(t.resize)}function c(e,n){return function(t,e){_=e.getBoundingClientRect(),t.x=t.pageX-_.left-(h.scrollX||h.pageXOffset),t.y=t.pageY-_.top-(h.scrollY||h.pageYOffset),t.x*=e.width/_.width,t.y*=e.height/_.height}(e,t.element),n=n||{},n.ox=n.x||e.x,n.oy=n.y||e.y,n.x=e.x,n.y=e.y,n.dx=n.x-n.ox,n.dy=n.y-n.oy,n}function m(a){for(a=function(t){if(t.preventDefault(),A=function(t){var e={};for(var i in t)n(t[i])?e[i]=function(t,e){return function(){t.apply(e,arguments)}}(t[i],t):e[i]=t[i];return e}(t),A.originalEvent=t,A.touches)for(F.length=A.touches.length,T=0;T<A.touches.length;T++)F[T]=c(A.touches[T],F[T]);else F.length=0,F[0]=c(A,W);return r(W,F[0],!0),A}(a),M=(O=z.indexOf(L=a.type))-1,t.dragging=!!/down|start/.test(L)||!/up|end/.test(L)&&t.dragging;M;)i(z[M])?e(t[z[M--]],a):i(z[O])?e(t[z[O++]],a):M=0}function g(){t.now=+new Date,t.running=!0}function v(){t.running=!1}var y,x,w,b,_,T,$,P,S,A,L,V,I,M,O,j,E,D=0,F=[],R=!1,N=!1,B=h.devicePixelRatio||1,G=t.type==u,q=t.type==l,W={x:0,y:0,ox:0,oy:0,dx:0,dy:0},z=[t.element,m,"mousedown","touchstart",m,"mousemove","touchmove",m,"mouseup","touchend",m,"click",m,"mouseout",m,"mouseover",d,function(n){V=n.keyCode,I="keyup"==n.type,U[V]=U[function(t){return f[t]||String.fromCharCode(t)}(V)]=!I,e(t[n.type],n)},"keydown","keyup",h,function(n){t.autopause&&("blur"==n.type?v:g)(),e(t[n.type],n)},"focus","blur",s,"resize"],U={};for(V in f)U[f[V]]=!1;return r(t,{touches:F,mouse:W,keys:U,dragging:!1,running:!1,millis:0,now:NaN,dt:NaN,destroy:function(){b=t.element.parentNode,T=p.indexOf(t),b&&b.removeChild(t.element),~T&&p.splice(T,1),a(!1),v()},toggle:function(){(t.running?v:g)()},clear:function(){q&&t.clearRect(0,0,t.width,t.height)},start:g,stop:v}),p.push(t),t.autostart&&g(),a(!0),s(),o(),t}(t)}},v=["ms","moz","webkit","o"],y=self,x=0,w="AnimationFrame",b="request"+w,_="cancel"+w,k=y[b],C=y[_],T=0;T<v.length&&!k;T++)k=y[v[T]+"Request"+w],C=y[v[T]+"Cancel"+w];return y[b]=k=k||function(t){var e=+new Date,n=c.max(0,16-(e-x)),i=setTimeout(function(){t(e+n)},n);return x=e+n,i},y[_]=C=C||function(t){clearTimeout(t)},g}),L.CanvasOverlay=L.ImageOverlay.extend({options:{opacity:1,id:"",interactive:!0,crossOrigin:!1},initialize:function(t,e){"use strict";this._bounds=t?L.latLngBounds(t):null,L.setOptions(this,e)},_initImage:function(){"use strict";var t;(t=this.options.el?this._image=this.options.el:this.options.id?this._image=document.getElementById(this.options.id):this._image=L.DomUtil.create("canvas","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""))).onselectstart=L.Util.falseFn,t.onmousemove=L.Util.falseFn,t.onload=L.bind(this.fire,this,"load"),this.options.crossOrigin&&(t.crossOrigin="")},_reset:function(){"use strict";L.ImageOverlay.prototype._reset.call(this);var t=this._image;t.width!==this.options.width&&(t.width=this.options.width),t.height!==this.options.height&&(t.height=this.options.height)}}),L.canvasOverlay=function(t,e){"use strict";return new L.CanvasOverlay(t,e)},function(){"use strict";var t=1;Object.defineProperty(Object.prototype,"__uniqueId",{writable:!0}),Object.defineProperty(Object.prototype,"uniqueId",{get:function(){return void 0===this.__uniqueId&&(this.__uniqueId=t++),this.__uniqueId}})}(),function(){"use strict";Vue.component("map-controls",{template:"#map-controls-template",props:{map:{type:Object}},data:function(){return{playbackRate:1}},mounted:function(){var t=$(this.$el).find("#playback-rate");t.attr("min",.1),t.attr("max",3),t.attr("step",.1)},computed:{locked:{get:function(){var t=!0,e=this.map;return _.has(e,"dragging")&&(t=!e.dragging.enabled()),t},set:function(t){console.log("locking map",t),t?this.lockMap():this.unlockMap()},cache:!1},particleSize:{get:function(){return _.get(this.$root.$refs,"particleComponent.radius")},set:function(t){this.$root.$refs.particleComponent.radius=parseFloat(t)},cache:!1},computedPlaybackRate:{get:function(){var t=$("#uv-video")[0];return _.get(t,"playbackRate",this.playbackRate)},set:function(t){this.playbackRate=t,$("#uv-video")[0].playbackRate=parseFloat(t)},cache:!1}},methods:{selectPoint:function(){console.log("selecting point")},lockMap:function(){var t=this.map;t.dragging.disable(),t.touchZoom.disable(),t.doubleClickZoom.disable(),t.scrollWheelZoom.disable(),t.tap&&t.tap.disable()},unlockMap:function(){var t=this.map;t.dragging.enable(),t.touchZoom.enable(),t.doubleClickZoom.enable(),t.scrollWheelZoom.enable(),t.tap&&t.tap.enable()}}}),Vue.component("toggle-controls",{template:"#toggle-controls-template",props:{sketch:{type:CanvasRenderingContext2D}},data:function(){return{toggleButtons:[{id:"maptoggle",icon:"fa-map-o",type:"toggle",banned:"mapControls.locked"},{id:"cleartoggle",icon:"fa-tint",type:"toggle",banned:"modelCanvas.clearAfterRender"}],actionButtons:[{id:"clearcanvas",icon:"fa-eraser",type:"button",actions:["modelCanvas.clear","particleComponent.clear"]},{id:"addparticle",icon:"fa-tencent-weibo",type:"button",actions:["particleComponent.add"]},{id:"addgrid",icon:"fa-th",type:"button",actions:["drawingCanvas.grid"]},{id:"addquiver",icon:"fa-long-arrow-right",type:"button",actions:["drawingCanvas.quiver"]}]}},mounted:function(){var t=this,e=L.Control.extend({options:{position:"topright"},onAdd:function(){return t.$el}});this.controls=[new e({})]},methods:{toggle:function(t){var e=this.$root;_.set(e.$refs,t.banned,!_.get(e.$refs,t.banned))},action:function(t){var e=this.$root;_.each(t.actions,function(t){_.get(e.$refs,t)()})},isBanned:function(t){var e=this.$root;return _.get(e.$refs,t.banned)},deferredMountedTo:function(t){var e=this;_.forEach(this.controls,function(e){e.addTo(t)}),_.forEach(this.$children,function(t){t.deferredMountedTo(e.$drawToggle)})}}}),Vue.component("canvas-layer",{template:"#canvas-layer-template",props:{model:{type:Object}},watch:{bounds:function(){this.setBounds()}},mounted:function(){var t=this.bounds;this.$drawingLayer=L.canvasOverlay(t,{el:this.$el,width:1024,height:1024})},computed:{bounds:{get:function(){var t=L.latLngBounds(L.latLng(0,0),L.latLng(1,1));if(_.has(this.model,"extent.ne")){var e=this.model,n=L.latLng(e.extent.sw[0],e.extent.sw[1]),i=L.latLng(e.extent.ne[0],e.extent.ne[1]);t=L.latLngBounds(n,i)}return t},cache:!1}},methods:{deferredMountedTo:function(t){var e=this;this.$drawingLayer.addTo(t),_.forEach(this.$children,function(t){t.deferredMountedTo(e.$drawingLayer)})},setBounds:function(){this.$drawingLayer.setBounds(this.bounds)}}})}(),function(){"use strict";var t=Vue.component("station-icon",{template:"#station-icon-template",props:{feature:{type:Object}},data:function(){return{}},methods:{},mounted:function(){}});Vue.component("realtime-overview",{template:"#realtime-overview-template",props:{model:{type:Object}},data:function(){return{realtime:[]}},mounted:function(){var t=this;fetch("data/realtime.json").then(function(t){return t.json()}).then(function(e){var n=e.realtime;_.each(n,function(t){t.loaded=!1}),t.realtime=e.realtime})},watch:{realtime:{handler:function(t){var e=_.filter(t,function(t){return t.loaded});bus.$emit("realtimes-selected",e)},deep:!0}},methods:{includes:function(t,e){return _.includes(t.types,e)},isGrid:function(t){return _.has(t,"grid")}}}),Vue.component("realtime-layer",{template:"#realtime-layer-template",props:{model:{type:Object},realtime:{type:Object},currentPoint:{type:Object},repository:{type:String,default:""}},data:function(){return{points:[],markerGroup:null,layerGroup:null}},watch:{points:function(){this.clearMarkers(),this.createMarkers()},realtime:function(){this.fetchData()}},components:{"station-icon":t},mounted:function(){_.isNil(this.layerGroup)&&this.deferredMountedTo(this.$parent.mapObject),this.fetchData()},computed:{},methods:{fetchData:function(){_.has(this.realtime,"points")&&this.fetchPoints()},fetchPoints:function(){var t=this;if(_.isNil(this.realtime))this.clearMarkers();else{var e=this.realtime.points;""!==this.repository&&(e.startsWith("http")||(e=urljoin(this.repository,e))),fetch(e).then(function(t){return t.json()}).then(function(e){_.each(e.features,function(t){t.properties.selected=!1}),Vue.set(t,"points",e)})}},deferredMountedTo:function(t){this.layerGroup=L.layerGroup([]),this.layerGroup.addTo(t),this.markerGroup&&this.layerGroup.addLayer(this.markerGroup)},createMarkers:function(){var e=this,n=L.markerClusterGroup({iconCreateFunction:function(t){var e="cluster-"+t._leaflet_id,n=L.divIcon({html:'<div class="cluster-icon" id="'+e+'"></div>'});return t.on("add",function(){var n=t.getAllChildMarkers(),i=_.map(n,function(t){return _.get(t,"options.feature.properties.locationColor","#eebb33")}),r=_.toPairs(_.groupBy(i)),a=d3.pie().value(function(t){return t[1].length}),o=Math.min(20,20)/2,s=d3.arc().outerRadius(o).innerRadius(0);d3.select("#"+e).append("svg").attr("width",20).attr("height",20).append("g").attr("transform","translate(10,10)").selectAll(".arc").data(a(r)).enter().append("g").attr("class","arc").append("path").attr("d",s).style("fill",function(t){return t.data[0]})}),n}});_.each(this.points.features,function(i,r){var a=_.get(i,"properties.lat",i.geometry.coordinates[1]),o=_.get(i,"properties.lon",i.geometry.coordinates[0]),s=L.latLng(a,o),c="station-icon-"+i.id,l=L.divIcon({html:'<station-icon :feature="points.features['+r+']" id="'+c+'"></station-icon>',iconSize:L.point(20,20)}),u=L.marker(s,{icon:l,feature:i});u.on("click",function(t){e.setChart(i,t)}),u.on("add",function(){var n=$(u.getElement()).find("station-icon");new t({parent:e,propsData:{feature:i}}).$mount(n[0])}),n.addLayer(u)}),this.markerGroup=n;var i=_.first(_.filter(this.points.features,function(t){return _.get(t,"properties.featured",!0)}));this.setChart(i),_.isNil(this.layerGroup)||this.layerGroup.addLayer(n)},clearMarkers:function(){this.layerGroup&&this.layerGroup.clearLayers()},setChart:function(t){_.each(this.points.features,function(t){t.properties.selected=!1}),t.properties.selected=!0,bus.$emit("feature-selected",t)}}})}();var AdvectionFilter,_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(){"use strict";var t="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}\n",e="\nvarying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\nuniform float decay;\nuniform vec2 scale;\nuniform bool flipv;\nuniform sampler2D uUVSampler;\nuniform sampler2D uSampler;\n\nbool isNaN(float val)\n{\n  return (val <= 0.0 || 0.0 <= val) ? false : true;\n}\n\nvoid main(void)\n{\n  // lookup in 0-1 space\n  vec2 coord = vFilterCoord;\n  // invert y if flipping\n  if (flipv) {\n    coord.y = 1.0 - coord.y;\n  }\n\n  vec4 map =  texture2D(uUVSampler, coord);\n  map -= 0.5;\n  map.xy *= scale;\n  // recompute scale if flipped\n  if (flipv) {\n    map.y = - map.y;\n  }\n\n\n\n  vec2 lookup = vec2(vTextureCoord.x - map.x, vTextureCoord.y - map.y);\n\n\n  vec4 color = texture2D(uSampler, lookup);\n  // I expected that I would have to apply this to the .a only..\n  color = vec4(color.rgb * decay, color.a * decay);\n  gl_FragColor = color;\n  if (map.z > 0.0) {\n    gl_FragColor *= 0.0;\n  }\n}";AdvectionFilter=function(n){function i(n,r){_classCallCheck(this,i);var a=new PIXI.Matrix;n.renderable=!1;var o=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));o.maskSprite=n,o.maskMatrix=a,o.uniforms.uUVSampler=n.texture,o.uniforms.filterMatrix=a.toArray(!0);var s=_.get(r,"scale",10);o.scale=new PIXI.Point(s,s);var c=_.get(r,"flipv",!1);o.flipv=c;var l=_.get(r,"decay",1);return o.decay=l,o}return _inherits(i,PIXI.Filter),_createClass(i,[{key:"apply",value:function(t,e,n){var i=1/n.destinationFrame.width*(n.size.width/e.size.width);this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x*i,this.uniforms.scale.y=this.scale.y*i,this.uniforms.flipv=this.flipv,this.uniforms.decay=this.decay,t.applyFilter(this,e,n)}},{key:"map",get:function(){return this.uniforms.uUVSampler},set:function(t){this.uniforms.uUVSampler=t}}]),i}()}();var sketch;!function(){"use strict";Vue.component("drawing-canvas",{template:"<div></div>",data:function(){return{canvas:null,sketch:null}},mounted:function(){var t=this;this.addDrawing(),this.$nextTick(function(){bus.$emit("drawing-canvas-created",t),bus.$on("model-selected",t.clear)})},methods:{clear:function(){this.sketch.clear()},deferredMountedTo:function(t){this.canvas=t._image,this.addDrawing()},addDrawing:function(){sketch=Sketch.create({element:this.canvas,container:null,autoclear:!1,fullscreen:!1,exists:!0,palette:["black","blue","red"],radius:3,painting:!1,hasDragged:!0,setup:function(){},update:function(){},keydown:function(t){bus.$emit("drawing-keydown",t,this)},mouseup:function(){},mousedown:function(){this.hasDragged=!1},mousemove:function(){this.hasDragged=!0},click:function(t){this.fillStyle=this.palette[Math.floor(Math.random()*this.palette.length)],this.beginPath();var e=t.x,n=t.y;this.arc(e,n,1,0,2*Math.PI),this.fill(),bus.$emit("drawing-click",this)},touchmove:function(){if(Modernizr.touch||this.keys.SHIFT){for(var t,e=this.touches.length-1;e>=0;e--)t=this.touches[e],this.lineCap="round",this.lineJoin="round",this.strokeStyle=this.palette[Math.floor(Math.random()*this.palette.length)],this.lineWidth=this.radius,this.beginPath(),this.moveTo(t.ox,t.oy),this.lineTo(t.x,t.y),this.stroke();bus.$emit("drawing-touchmove",this)}}}),Vue.set(this,"sketch",sketch),this.$nextTick(function(){bus.$emit("sketch-created",sketch)})},grid:function(){var t=this.sketch;_.each(_.range(0,1024,Math.pow(2,7)),function(e){t.strokeStyle="black",t.beginPath(),t.moveTo(e,0),t.lineTo(e,1024),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(0,e),t.lineTo(1024,e),t.closePath(),t.stroke()})},quiver:function(){var t=this.sketch;_.each(_.range(0,100),function(){var e=1024*Math.random(),n=1024*Math.random();t.strokeStyle="white",t.beginPath(),t.arc(e,n,1,0,2*Math.PI),t.closePath(),t.stroke()})}}}),$(function(){$("#images a.thumbnail").click(function(t){var e=$(t.currentTarget).find("img").attr("src"),n=new Image;n.onload=function(){sketch.drawImage(n,0,0)},n.src=e,t.preventDefault()})})}(),function(){"use strict";Vue.component("model-details",{template:"#model-details-template",props:["model"],data:function(){return{}},methods:{select:function(){console.log("selecting",this.model),bus.$emit("model-selected",this.model)},formatStartTime:function(){return moment(this.model.extent.time[0]).calendar()},formatDuration:function(){var t=moment(this.model.extent.time[0]),e=moment(this.model.extent.time[1]);return moment.duration(e.diff(t)).humanize()}}}),Vue.component("models-overview",{template:"#models-overview-template",props:{repository:{type:String,default:""}},data:function(){return{models:[],icons:{default:"http://www.openearth.nl/painting/images/icons/deltares.png"}}},mounted:function(){var t=this;fetch("data/icons.json",{mode:"cors"}).then(function(t){return t.json()}).then(function(e){t.icons=e});var e="data/models.json";""!==this.repository&&(e=this.repository.endsWith("models")?this.repository:urljoin(this.repository,"models.json")),fetch(e,{mode:"cors"}).then(function(t){return t.json()}).then(function(e){t.models=_.get(e,"models",e);var n=_.first(_.filter(t.models,["id",t.$root.settings.model]));_.isNil(n)&&(n=_.first(t.models)),t.selectModel(n)}).catch(function(t){console.warn("parsing failed",t)})},methods:{selectModel:function(t){var e=new CustomEvent("model-selected",{detail:t});document.dispatchEvent(e),bus.$emit("model-selected",t)},formatStartTime:function(t){return moment(t.extent.time[0]).calendar()},formatDuration:function(t){var e=moment(t.extent.time[0]),n=moment(t.extent.time[1]);return moment.duration(n.diff(e)).humanize()},lookupIcon:function(t){var e=this.icons.default;return _.has(t,"metadata.icon")?(e=t.metadata.icon,this.repository&&(e=urljoin(this.repository,e))):(_.has(this.icons,t.metadata.title)&&(e=this.icons[t.metadata.title]),_.has(this.icons,t.id)&&(e=this.icons[t.id])),e},nestedModels:function(){var t=_.reverse(_.sortBy(this.models,function(t){return t.extent.time[0]})),e=_.groupBy(t,function(t){return _.get(t,"metadata.title",t.title)});return _.map(e,function(t,e){return{title:e,items:t,metadata:t[0].metadata,active:!1,icon:"folder"}})}}})}(),function(){"use strict";function t(t,e,n){this.model=t,this.canvas=e,this.uv=n,this.width=e.width,this.height=e.height,this.particleAlpha=.8,this.replace=!0,this.particles=[],this.color="rgba(255, 91, 126, 0.8)",this.r=1,this.fade=.95,this.counter=0,this.state="STOPPED",this.offScreen=document.createElement("canvas"),this.offScreen.width=this.canvas.width,this.offScreen.height=this.canvas.height}t.prototype.startAnimate=function(){function t(){"STOPPED"!==this.state&&(requestAnimationFrame(t.bind(this)),i=Date.now(),(e=i-r)<a||this.particles.length&&(this.step(60/n),this.render(),r=i-e%a))}var e,n=15,i=Date.now(),r=Date.now(),a=1e3/n;this.state="STARTED",t.bind(this)()},t.prototype.stopAnimate=function(){this.state="STOPPED"},t.prototype.create=function(){var t=new PIXI.Sprite;return t.anchor.set(.5),t.alpha=this.particleAlpha,t.x=Math.random()*this.width,t.y=Math.random()*this.height,t},t.prototype.clear=function(){this.particles.splice(0);var t=this.canvas.getContext("2d"),e=this.canvas.width,n=this.canvas.height;this.offScreen.getContext("2d").clearRect(0,0,e,n),t.clearRect(0,0,e,n)},t.prototype.culling=function(t){for(var e=this.particles.length,n=t,i=e-1;i>=n;i--)_.pullAt(this.particles,i),this.sprites.removeChildAt(i);for(var r=0;r<n-e;r++){var a=this.create();this.particles.push(a)}},t.prototype.step=function(t){var e=this;if(this.particles.length&&!this.uv.paused&&!this.uv.ended){var n=_.get(this.model,"uniforms.scale",2),i=$("#uv-canvas")[0],r=i.getContext("2d"),a=i.width,o=i.height,s=r.getImageData(0,0,a,o);_.each(this.particles,function(i){var r=4*(Math.round(o-i.position.y)*a+Math.round(i.position.x)),c=s.data[r+0]/255-.5,l=s.data[r+1]/255-.5;l*=e.model.flipv?1:-1;var u=s.data[r+2]/255>.5;u=u||Math.abs(c)+Math.abs(l)===0,i.position.x=i.position.x+c*n*t,i.position.y=i.position.y+l*n*t,u=(u=(u=(u=(u=(u=u||i.position.x>a)||i.position.x<0)||i.position.y>o-1)||i.position.y<10)||isNaN(i.position.x))||isNaN(i.position.y);var d=Math.atan2(l,c)-.5*Math.PI-i.rotation;if(Math.abs(d)>.1&&(d=d>0?.1:-.1),i.rotation+=d,u&&(_.pull(e.particles,i),e.replace)){var h=e.create();e.particles.push(h)}},this),this.counter++}},t.prototype.render=function(){var t=this.canvas.getContext("2d"),e=this.canvas.width,n=this.canvas.height,i=this.offScreen.getContext("2d");if(this.counter%20==0){for(var r=t.getImageData(0,0,e,n),a=r.data,o=this.fade,s=0,c=a.length;s<c;s+=4)a[s+3]<=1-o&&(a[s+3]=0);i.putImageData(r,0,0)}else i.globalCompositeOperation="copy",i.drawImage(this.canvas,0,0);t.fillStyle="white",t.clearRect(0,0,e,n),t.globalAlpha=this.fade,t.drawImage(this.offScreen,0,0),t.globalAlpha=1,t.fillStyle=this.color,t.beginPath();var l=this.r;_.each(this.particles,function(e){t.moveTo(e.x+l,e.y),t.arc(e.x,e.y,l,0,2*Math.PI)}),t.closePath(),t.fill()},Vue.component("particle-component",{template:"#particle-component-template",props:["model"],data:function(){return{particles:null,pipeline:null,stage:null,renderer:null,canvas:null}},mounted:function(){bus.$on("model-selected",this.resetParticles)},watch:{"model.uv":"resetParticles",pipeline:"resetParticles"},computed:{radius:{get:function(){return _.get(this.particles,"r")},set:function(t){this.particles.r=t},cache:!1},width:{get:function(){return _.get(this,"canvas.width")}},height:{get:function(){return _.get(this,"canvas.height")}}},methods:{deferredMountedTo:function(e){if(this.canvas=e._image,!_.isNil(this.model)){var n=$("#uv-"+this.model.uv.tag)[0];this.particles&&this.particles.stopAnimate(),Vue.set(this,"particles",new t(this.model,this.canvas,n,{radius:this.radius})),this.particles.startAnimate()}},resetParticles:function(){if(!_.isNil(this.model)&&!_.isNil(this.canvas)){var e=$("#uv-"+this.model.uv.tag)[0];this.clear(),Vue.set(this,"particles",new t(this.model,this.canvas,e)),this.particles.startAnimate(),this.add()}},add:function(){_.isNil(this.model)||_.isNil(this.particles)||this.particles.culling(this.particles.particles.length+50)},removeParticles:function(){this.particles&&this.particles.clear()},clear:function(){this.removeParticles()}}})}(),function(){"use strict";Vue.component("uv-source",{template:"#uv-source-template",props:{model:{type:Object,required:!1},repository:{type:String,default:""}},data:function(){return{loaded:!1}},mounted:function(){function t(){if(requestAnimationFrame(t.bind(this)),n=Date.now(),(e=n-i)>r){if(i=n-e%r,!this.video)return;if(!this.uvctx)return;var o=this.video.width,s=this.video.height;this.uvctx.drawImage(this.video,0,0,o,s),a++}}var e,n=Date.now(),i=Date.now(),r=1e3/3,a=0;t.bind(this)()},watch:{uv:function(t){var e=this,n=this.video,i=t.src;""!==this.repository&&(t.src.startsWith("http")||(i=urljoin(this.repository,t.src))),n.src=i,n.setAttribute("crossorigin","anonymous"),n.height=t.height,n.width=t.width,this.loaded=!1,"video"===this.model.uv.tag&&(this.video.currentTime=this.video.currentTime,$(this.video).bind("loadeddata",function(){Vue.set(e.model,"duration",e.video.duration),e.loaded||(e.loaded=!0,bus.$emit("video-loaded",n))}),$(this.video).bind("timeupdate",function(){Vue.set(e.model,"currentTime",e.video.currentTime)})),n.load()}},computed:{tag:{get:function(){return _.get(this.model,"uv.tag","video")},cache:!1},uv:{get:function(){return this.model?this.model.uv:null},cache:!1},video:{get:function(){return document.getElementById("uv-video")},cache:!1},uvctx:{get:function(){return document.getElementById("uv-canvas").getContext("2d")},cache:!1},img:{get:function(){return document.getElementById("uv-img")},cache:!1}}}),Vue.component("model-canvas",{template:"<div>model</div>",props:{model:{type:Object,required:!1},sketch:{type:CanvasRenderingContext2D,required:!1}},data:function(){return{state:"STOPPED",drawingTexture:null,videoElement:null,videoSprite:null,stage:null,renderer:null,renderTextureFrom:null,renderTextureTo:null,pipeline:null,advectionFilter:null,clearAfterRender:!0}},mounted:function(){var t=this;bus.$on("video-loaded",function(t){this.createVideoTexture(t),this.checkAndRun()}.bind(this)),Vue.nextTick(function(){bus.$on("model-selected",t.clear)})},computed:{width:{get:function(){return _.get(this,"canvas.width")}},height:{get:function(){return _.get(this,"canvas.height")}},drawing:{get:function(){return _.get(this,"sketch")},cache:!1}},watch:{"model.uniforms":function(){this.updateUniforms()},drawing:function(t){t&&(this.createDrawingTexture(t),this.checkAndRun())}},methods:{checkAndRun:function(){this.videoSprite&&this.drawingSprite&&(this.advectionFilter||(this.createFilter(),this.startAnimate(),this.updateUniforms()))},clear:function(){var t=new PIXI.Container;this.renderer.render(t,this.renderTextureTo,!0),this.renderer.render(t,this.renderTextureFrom,!0)},deferredMountedTo:function(t){this.canvas=t._image,this.createRenderer()},createRenderer:function(){var t=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:!0,clearBeforeRender:!1,preserveDrawingBuffer:!1}),e=new PIXI.Container,n=new PIXI.Container;Vue.set(this,"pipeline",n),Vue.set(this,"stage",e),Vue.set(this,"renderer",t)},createVideoTexture:function(t){var e=PIXI.Texture.fromVideo(t),n=new PIXI.Sprite(e);if(n.width=this.width,n.height=this.height,this.videoSprite){var i=this.stage.getChildIndex(this.videoSprite);this.stage.removeChildAt(i),this.stage.addChildAt(n,i)}else this.stage.addChild(n);this.videoSprite=n,this.advectionFilter&&(this.advectionFilter.map=n.texture),n.renderable=!1,this.stage.addChild(this.videoSprite)},createDrawingTexture:function(t){if(t){var e=t,n=PIXI.Texture.fromCanvas(t.element),i=new PIXI.Sprite(n);this.drawingContext=e,this.drawingSprite=i,this.drawingTexture=n}else console.warn("Expected a drawing canvas")},updateUniforms:function(){if(this.advectionFilter&&this.model){var t=this.model;this.advectionFilter.scale.x=_.get(t,"uniforms.scale",2),this.advectionFilter.scale.y=_.get(t,"uniforms.scale",2),this.advectionFilter.flipv=_.get(t,"uniforms.flipv",!0),this.advectionFilter.decay=_.get(t,"uniforms.decay",.999)}},createFilter:function(){var t=this,e=this.videoSprite,n=this.width,i=this.height;this.stage.addChild(this.pipeline),this.pipeline.addChild(this.drawingSprite);var r=new AdvectionFilter(e,{scale:1,flipv:!1,decay:.99,upwind:!1});this.stage.addChild(e),this.pipeline.filters=[r];var a=PIXI.RenderTexture.create(n,i),o=new PIXI.Sprite(a),s=PIXI.RenderTexture.create(n,i);this.renderTextureFrom=a,this.renderTextureTo=s,this.renderSpriteFrom=o,this.pipeline.addChild(o),this.pipeline.addChild(this.drawingSprite),this.advectionFilter=r,this.$nextTick(function(){bus.$emit("pipeline-created",t.pipeline)})},stopAnimage:function(){this.state="STOPPED"},startAnimate:function(){function t(){if("STOPPED"!==l&&(requestAnimationFrame(t.bind(this)),(e=this.videoSprite).texture.valid&&e.texture.baseTexture.hasLoaded)){var h=e.texture.baseTexture.source;if(!(h.readyState<h.HAVE_ENOUGH_DATA)&&-1!==s.children.indexOf(e)){n.update(),i.render(s),i.render(s,r,!0),o.texture=r;var p=a;a=r,r=p,this.clearAfterRender&&(i.render(d,r,!0),c.clearRect(0,0,u.element.width,u.element.height))}}}this.state="STARTED";var e=this.videoSprite,n=this.drawingTexture,i=this.renderer,r=this.renderTextureTo,a=this.renderTextureFrom,o=this.renderSpriteFrom,s=this.stage,c=this.drawingContext,l=this.state,u=this.drawing,d=new PIXI.Container;t.bind(this)()}}})}(),function(){"use strict";Vue.component("color-selection",{template:"#color-selection-template",props:{color:{type:Object},palette:{type:Array}},mounted:function(){},data:function(){return{colorToggleOptions:[{icon:"colorize",value:"color"},{icon:"color_lens",value:"palette"}],colorType:"color",painting:{palette:[]}}},methods:{onColorChange:function(t){bus.$emit("color-selected",t)},onPaintingSelected:function(t){Vue.set(this,"painting",t)}}}),Vue.component("painting-palettes",{template:"#paintings-template",data:function(){return{paintings:[]}},mounted:function(){var t=this;fetch("data/paintings.json").then(function(t){return t.json()}).then(function(e){t.paintings=e,t.select(t.paintings[0])})},methods:{select:function(t){this.$emit("select",t)}}}),Vue.component("palette-chart",{template:"#palette-chart-template",data:function(){return{}},props:{palette:{type:Array,default:function(){return[]}}},mounted:function(){},watch:{palette:function(){this.updateChart(),this.selectAll(),this.selectPalette()}},computed:{svg:{get:function(){return d3.select("#palette").select("svg")},cache:!1}},methods:{selectPalette:function(){var t=[];d3.select("#palette").select("svg").selectAll("circle.active").each(function(e){var n=d3.rgb(255*e.rgb[0],255*e.rgb[1],255*e.rgb[2]);t.push(n)}),bus.$emit("palette-selected",t)},deselectAll:function(){this.svg.select("g").selectAll("circle").classed("active",!1),this.selectPalette()},selectAll:function(){this.svg.select("g").selectAll("circle").classed("active",!0),this.selectPalette()},updateChart:function(){var t=this.svg,e=t.select("g");t.attr("width",260).attr("height",200);var n=d3.scaleLinear().range([0,260]).domain([-.1,1.1]).nice(),i=d3.scaleLinear().range([200,0]).domain([-.1,1.1]).nice();e.selectAll("circle").remove(),e.selectAll("circle").data(this.palette).enter().append("circle").attr("cx",function(t){return n(t.x)}).attr("cy",function(t){return i(t.y)}).attr("r",10).style("fill",function(t){return d3.rgb(255*t.rgb[0],255*t.rgb[1],255*t.rgb[2])}).on("click",function(){d3.select(this).classed("active",!d3.select(this).classed("active")),this.selectPalette()}),this.selectAll()}}})}(),function(){"use strict";Vue.component("key-bindings",{template:"#key-bindings-template",data:function(){var t=this,e=this.$root;return{keyBindings:[{key:"p",description:"Particles",method:function(){_.has(e,"$refs.particleComponent.add")&&e.$refs.particleComponent.add()},arguments:{}},{key:"c",method:function(){t.clear()},description:"Clear canvas",arguments:{}},{key:"q",description:"Quiver like plot",method:function(){e.$refs.drawingCanvas.quiver()}},{key:"g",description:"Grid plot",method:function(){e.$refs.drawingCanvas.grid()}}]}},mounted:function(){window.addEventListener("keyup",this.keyUp),bus.$on("drawing-keydown",this.drawingKey)},methods:{drawingKey:function(t,e){var n=_.first(_.filter(this.keyBindings,["key",t.key]));_.isNil(n)||n.method(t,e)},keyUp:function(t){var e=_.first(_.filter(this.keyBindings,["key",t.key]));_.isNil(e)||e.method(e.arguments)},clear:function(){var t=this.$root;_.has(t.$refs,"drawingCanvas")?t.$refs.drawingCanvas.clear():console.warn("Expected drawingCanvas on",t.$refs),_.has(t.$refs,"modelCanvas")?t.$refs.modelCanvas.clear():console.warn("Expected modelCanvas on",t.$refs),_.has(t.$refs,"particleComponent")?t.$refs.particleComponent.clear():console.warn("Expected particleCanvas on",t.$refs)}}})}(),function(){"use strict";Vue.component("story-container",{template:"#story-container-template",data:function(){return{storyUrl:"data/stories/ecomare.json",story:null}},mounted:function(){var t=this;this.$nextTick(function(){var e=new ScrollMagic.Controller({container:t.$el,loglevel:3});console.log("adding story to ",t.$el);var n=t.$root;fetch(t.storyUrl).then(function(t){return t.json()}).then(function(i){Vue.set(t,"story",i),t.$nextTick(function(){var r=t.$el.getElementsByClassName("story-item");_.each(r,function(t,r){var a=i.items[r];console.log("combining",t,"with",a,t.clientHeight);var o=new ScrollMagic.Scene({triggerElement:t,duration:t.clientHeight}).on("enter",function(){console.log("entering item",a),_.has(a,"latlng")&&n.$refs.map.mapObject.flyTo(L.latLng(a.latlng),a.zoom)}).addIndicators().addTo(e);console.log("add scene",o)});var a=Array.from(t.$el.getElementsByClassName("jssor-slider-container"));_.map(a,function(t){return new $JssorSlider$(t.id,{$AutoPlay:!0})})})})})}})}(),function(){"use strict";Vue.component("chart-container",{template:"#chart-container-template",props:{model:{type:Object},realtime:{type:Object},repository:{type:String,default:""}},data:function(){return{series:[],limits:[],feature:null,chart:null}},mounted:function(){var t=this;this.createChart(),bus.$on("feature-selected",function(e){if(t.feature=e,_.has(e,"properties.series"))Vue.set(t,"series",[e.properties.series]);else if(_.has(e,"properties.locationCode")){var n=t.realtime.details,i=_.get(e,"properties.locationCode",e.id);_.includes(n,"${location}")&&(n=_.template(n)({location:i})),""!==t.repository&&(n.startsWith("http")||(n=urljoin(t.repository,n))),fetch(n).then(function(t){return t.json()}).then(function(e){Vue.set(t,"series",e.series),Vue.set(t,"limits",_.get(e,"limits",[]))})}}),this.$nextTick(function(){var t=this;window.addEventListener("resize",function(){t.createChart(),t.updateChart()}),this.updateChart()})},watch:{progress:function(t){if(!_.isNaN(t)){var e=[{x:t,y:0},{x:t,y:1}];this.chart.pathProgress.datum(e).transition().attr("d",this.chart.lineProgress)}},series:function(){this.updateChart()},model:function(){this.updateChart()}},computed:{progress:{cache:!1,get:function(){return _.has(this.model,"currentTime")?this.model.currentTime/this.model.duration:0}},name:{cache:!1,get:function(){return _.get(this.feature,"properties.name")}}},methods:{updateChart:function(){var t=this;if(this.model){var e=[moment().subtract(1,"days").toDate(),moment().toDate()];if(_.has(this.model.extent,"time"))e=_.map(this.model.extent.time,d3.isoParse);else{var n=_.map(_.flatMap(_.flatMap(this.series,"data"),"dateTime"),d3.isoParse);e=d3.extent(n)}this.chart.xTime.domain(e);var i=_.flatMap(_.flatMap(this.series,"data"),"value"),r=d3.extent(i),a=_.get(this.model.extent,"waterlevel",r);if(this.chart.yWaterlevel.domain(a),this.chart.xAxis.transition().call(d3.axisBottom(this.chart.xTime)),this.chart.yAxis.transition().call(d3.axisLeft(this.chart.yWaterlevel).ticks(5)),this.series.length){this.chart.g.selectAll(".series").remove(),this.chart.g.selectAll(".limits").remove(),this.chart.g.selectAll(".limits").data(this.limits).enter().append("rect").attr("class","limits clipped").attr("x",function(){var n=e[0];return t.chart.xTime(n)}).attr("y",function(e){var n=a[1];return _.isNil(e.to)||(n=e.to),t.chart.yWaterlevel(n)}).attr("width",function(){var n=e[1],i=e[0];return t.chart.xTime(n)-t.chart.xTime(i)}).attr("height",function(e){var n=a[0];_.isNil(e.from)||(n=e.from);var i=a[1];_.isNil(e.to)||(i=e.to);var r=t.chart.yWaterlevel(n)-t.chart.yWaterlevel(i);return r<0?0:r}).style("fill",function(t){return t.color}).style("opacity",.2);var o=this.chart.g.selectAll(".series").data(this.series).enter().append("g").attr("class","series"),s=d3.line().x(function(e){var n=d3.isoParse(e.date||e.dateTime);return t.chart.xTime(n)}).y(function(e){return t.chart.yWaterlevel(e.s1||e.value)});o.append("path").attr("class","line waterlevel clipped").attr("d",function(t){return s(_.get(t,"data",t))}).style("stroke",function(t){return t.color})}}},createChart:function(){var t={top:14,right:14,bottom:28,left:34},e=this.$el.clientWidth-t.left-t.right,n=this.$el.clientHeight-t.top-t.bottom,i=d3.scaleTime().range([0,e]),r=d3.scaleLinear().range([0,e]),a=d3.scaleLinear().range([n,0]),o=d3.scaleLinear().range([n,0]),s=$(this.$el).find("svg")[0],c=d3.select(s);c.selectAll("*").remove(),c.attr("width",e+t.left+t.right).attr("height",n+t.top+t.bottom);var l=c.append("g").attr("transform","translate("+t.left+","+t.top+")");l.append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",n);var u=l.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+n+")"),d=l.append("g").attr("class","axis axis--y");d.append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y",-t.left).attr("dy","1em").attr("x",-n/2).style("text-anchor","middle").text("water hoogte [m]");var h=[{x:this.progress,y:0},{x:this.progress,y:1}],p=d3.line().x(function(t){return r(t.x)}).y(function(t){return a(t.y)}),m=l.datum(h).append("path").attr("class","line").attr("d",p),f={svg:c,g:l,xTime:i,xLinear:r,yWaterlevel:o,yLinear:a,width:e,height:n,xAxis:u,yAxis:d,lineProgress:p,pathProgress:m};Vue.set(this,"chart",f)}}})}(),function(){"use strict";Vue.component("wind-rose",{template:"#wind-rose-template",props:{model:{type:Object},currentPoint:{type:Object},url:{type:String,default:"http://stathakis-dev.eu-west-1.elasticbeanstalk.com/stathakis/1.0.0/grids/ncep/measurements/wind?lat=${lat}&lon=${lon}&start_time=${startTime}&end_time=${endTime}"},selectingPoint:{type:Boolean}},data:function(){return{series:[],arrow:null,path:null,svg:null,loading:!1}},watch:{"model.currentTime":function(t){if(this.series.length){var e=moment(this.model.extent.time[0]),n=moment(this.model.extent.time[1])-e,i=e+t/_.get(this.model,"duration",1)*n,r=d3.bisector(function(t){return t.date}).left,a=_.clamp(r(this.series,i),0,this.series.length-1),o=this.series[a];this.arrow.datum([{u:0,v:0},o]).transition().attr("d",this.line);var s=_.slice(this.series,0,a+1);this.path.datum(s).transition().duration(500).attr("d",this.line)}},currentPoint:function(){this.updateWindSeries()},series:function(){this.updateAxis()}},mounted:function(){var t=this.$el.querySelector(".wind-rose"),e=d3.select(t);this.svg=e,!_.isNil(this.model)&&this.url&&this.updateWindSeries(),this.updateAxis()},computed:{lat:{get:function(){return this.currentPoint.lat},cache:!1},lon:{get:function(){return this.currentPoint.lng},cache:!1},displayLatLng:{get:function(){return _.template("${lat}&deg;N, ${lon}&deg;E")({lat:this.lat.toFixed(3),lon:this.lon.toFixed(3)})},cache:!1}},methods:{selectPoint:function(){bus.$emit("select-point")},updateAxis:function(){var t=this.svg;t.attr("width",280).attr("height",280);var e=Math.min(280,280)/2-48,n=10;if(this.series.length){var i=_.map(this.series,function(t){return Math.sqrt(Math.pow(t.u,2)+Math.pow(t.v,2))});n=_.max(i)}var r=d3.scaleLinear().domain([0,n]).range([0,e]),a=d3.radialLine().radius(function(t){var e=Math.sqrt(Math.pow(t.u,2)+Math.pow(t.v,2));return r(e)}).angle(function(t){return Math.atan2(t.v,t.u)});this.line=a;var o=t.select("#chart").attr("transform","translate(140,140)");o.select("g.r.axis").selectAll("*").remove();var s=o.select("g.r.axis").selectAll("g").data(r.ticks(3).slice(1)).enter().append("g");s.selectAll("circle").remove(),s.append("circle").attr("r",r),s.selectAll("text").remove(),s.append("text").attr("y",function(t){return-r(t)-4}).attr("transform","rotate(15)").style("text-anchor","middle").text(function(t){return t.toFixed(0)});var c=o.select("g.a.axis").selectAll("g").data(d3.range(0,360,30)).enter().append("g").attr("transform",function(t){return"rotate("+-t+")"});c.append("line").attr("x2",e),c.append("text").attr("x",e+6).attr("dy",".35em").style("text-anchor",function(t){return t<270&&t>90?"end":null}).attr("transform",function(t){return t<270&&t>90?"rotate(180 "+(e+6)+",0)":null}).text(function(t){return t+"Â°"});var l=o.select("path.line").datum([]).attr("d",a);this.path=l;var u=o.select("path.arrow");this.arrow=u},updateWindSeries:function(){var t=this;this.loading=!0;var e=moment(this.model.extent.time[0]).toISOString(),n=moment(this.model.extent.time[1]).toISOString(),i=_.template(this.url)({lat:this.lat,lon:this.lon,startTime:e,endTime:n});fetch(i).then(function(t){return t.json()}).then(function(e){t.series=e.series,_.each(t.series,function(t){t.date=moment(t.dateTime)}),t.loading=!1})}}})}();var app,bus,_slicedToArray=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){"use strict";var t={hex:"#194d33",hsl:{h:150,s:.5,l:.2,a:1},hsv:{h:150,s:.66,v:.3,a:1},rgba:{r:25,g:77,b:51,a:1},a:1};$(document).ready(function(){bus=new Vue;var e=_.get(Vuetify,"default",Vuetify);Vue.use(e);_.each(_.toPairs({"v-sidebar":"VSidebar"}),function(t){var e=_slicedToArray(t,2),n=e[0],i=e[1];Vue.component(n,Vue.options.components[i])}),Vue.component("v-marker",Vue2Leaflet.Marker),Vue.component("v-poly",Vue2Leaflet.Polyline),Vue.component("v-group",Vue2Leaflet.LayerGroup),Vue.component("v-map",Vue2Leaflet.Map),Vue.component("v-color-picker",VueColor.Chrome),Vue.component("v-tilelayer",Vue2Leaflet.TileLayer),$("#template-container").load("templates/templates.html",function(){app=new Vue({el:"#app",mounted:function(){this.$nextTick(function(){})},data:function(){var e=urlParams(),n={settings:{sidebar:!0,story:!1,chart:!0,repository:"https://rvfqs9rqlc.execute-api.eu-west-1.amazonaws.com/dev/models"},color:t,palette:[],pipeline:null,model:null,realtimes:[],currentRealtime:null,currentPoint:null,selectingPoint:!1,sketch:null,sidebar:!1};return _.assign(n.settings,e),n},methods:{pointSelected:function(t){bus.$emit("point-selected",t.latlng),this.selectingPoint=!1}},computed:{map:{get:function(){return _.get(this.$refs,"map.mapObject")},cache:!1},chart:{get:function(){return _.isObjectLike(this.currentRealtime)},cache:!1},zoom:{get:function(){return _.get(this.model,"view.zoom",5)},cache:!1},center:{get:function(){var t=[0,0];if(_.has(this.model,"extent.sw")){var e=this.model,n=L.latLng(e.extent.sw[0],e.extent.sw[1]),i=L.latLng(e.extent.ne[0],e.extent.ne[1]);t=[(n.lat+i.lat)/2,(n.lng+i.lng)/2]}return t=_.get(this.model,"view.center",t)},cache:!1}}}),bus.$on("select-point",function(){Vue.set(app,"selectingPoint",!0)}),bus.$on("point-selected",function(t){Vue.set(app,"currentPoint",t)}),bus.$on("model-selected",function(t){Vue.set(app,"model",t),Vue.set(app,"currentPoint",L.latLng(app.center))}),bus.$on("realtimes-selected",function(t){Vue.set(app,"realtimes",t),t.length>0?Vue.set(app,"currentRealtime",t[0]):Vue.set(app,"currentRealtime",null)}),bus.$on("palette-selected",function(t){Vue.set(app,"palette",t),Vue.set(app.sketch,"palette",t)}),bus.$on("color-selected",function(t){Vue.set(app,"color",t),Vue.set(app.sketch,"palette",[val2rgbaString(t)])}),bus.$on("model-layer-added",function(){}),bus.$on("sketch-created",function(t){Vue.set(app,"sketch",t)}),bus.$on("pipeline-created",function(t){Vue.set(app,"pipeline",t)})})})}();